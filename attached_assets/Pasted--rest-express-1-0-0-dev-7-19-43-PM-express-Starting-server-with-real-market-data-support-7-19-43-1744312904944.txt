
> rest-express@1.0.0 dev
7:19:43 PM [express] Starting server with real market data support
7:19:43 PM [express] Development auto-login mode: ENABLED
Environment variables available: [
  'ALPACA_API_KEY: (sensitive)',
  'ALPACA_API_SECRET: (sensitive)',
  'POLYGON_API_KEY: (sensitive)',
  'OPENAI_API_KEY: (sensitive)',
  'ALPHAVANTAGE_API_KEY: (sensitive)',
  'SNAPTRADE_CLIENT_ID: present',
  'SNAPTRADE_CONSUMER_KEY: (sensitive)',
  'REPL_IDENTITY_KEY: (sensitive)',
  'REPL_PUBKEYS: (sensitive)'
]
SNAPTRADE_CLIENT_ID exists: true
SNAPTRADE_CONSUMER_KEY exists: true
API Endpoint being used: https://api.snaptrade.com/api/v1
Initializing SnapTrade service with config: {
  clientId: 'CRE...33chars',
  consumerKey: 'NXn...50chars',
  apiEndpoint: 'https://api.snaptrade.com/api/v1'
}
Using SnapTrade authorization headers with format: {
  'Content-Type': 'application/json',
  Accept: 'application/json',
  Authorization: 'Bearer NXnmq...'
}
SnapTrade SDK service initialized with credentials
Server environment: Development, Replit: Yes
Auto-login: Enabled
Twilio client initialized successfully with SID: ACba2... and phone number: +14158771976
WebSocketServer initialized on path /ws with enhanced Replit/Cloudflare compatibility settings
7:19:44 PM [express] Setting up Vite for development...
7:19:44 PM [express] ðŸš€ Server is running on port 5000 with real market data support
7:19:44 PM [express] Alpaca API credentials found - using Alpaca as primary market data provider
7:19:44 PM [express] ðŸ‘¤ Development auto-login enabled: A dev_user will be created/used automatically
Browserslist: browsers data (caniuse-lite) is 6 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
7:20:02 PM [express] GET /api/auth/user 304 in 155ms
7:20:02 PM [express] GET /api/auth/user 304 in 154ms
7:20:03 PM [express] GET /api/login 200 in 149ms
Auth debug - Req path: /api/integrations
Auth debug - isAuthenticated method exists: true
Auth debug - isAuthenticated result: true
Auth debug - Has user object: true
Auth debug - Auth header: Missing
Auth debug - Session user: Missing
Auth debug - Session authenticated: No
Critical error in auth wrapper: ReferenceError: Cannot access 'authReq' before initialization
    at <anonymous> (/home/runner/workspace/server/middleware/auth.ts:220:95)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/runner/workspace/node_modules/express/lib/router/route.js:149:13)
    at authMiddleware (/home/runner/workspace/server/middleware/auth.ts:73:18)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
7:20:03 PM [express] GET /api/login 200 in 152ms
Auth debug - Req path: /api/integrations
Auth debug - isAuthenticated method exists: true
Auth debug - isAuthenticated result: true
Auth debug - Has user object: true
Auth debug - Auth header: Missing
Auth debug - Session user: Missing
Auth debug - Session authenticated: No
Critical error in auth wrapper: ReferenceError: Cannot access 'authReq' before initialization
    at <anonymous> (/home/runner/workspace/server/middleware/auth.ts:220:95)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/runner/workspace/node_modules/express/lib/router/route.js:149:13)
    at authMiddleware (/home/runner/workspace/server/middleware/auth.ts:56:18)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/runner/workspace/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/home/runner/workspace/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at /home/runner/workspace/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/home/runner/workspace/node_modules/express/lib/router/index.js:346:12)
    at next (/home/runner/workspace/node_modules/express/lib/router/index.js:280:10)
    at strategy.pass (/home/runner/workspace/node_modules/passport/lib/middleware/authenticate.js:355:9)
    at SessionStrategy.authenticate (/home/runner/workspace/node_modules/passport/lib/strategies/session.js:126:10)
    at attempt (/home/runner/workspace/node_modules/passport/lib/middleware/authenticate.js:378:16)
    at authenticate (/home/runner/workspace/node_modules/passport/lib/middleware/authenticate.js:379:7)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at trim_prefix (/home/runner/workspace/node_modules/express/lib/router/index.js:328:13)
    at /home/runner/workspace/node_modules/express/lib/router/index.js:286:9
    at Function.process_params (/home/runner/workspace/node_modules/express/lib/router/index.js:346:12)
    at next (/home/runner/workspace/node_modules/express/lib/router/index.js:280:10)
    at initialize (/home/runner/workspace/node_modules/passport/lib/middleware/initialize.js:98:5)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at trim_prefix (/home/runner/workspace/node_modules/express/lib/router/index.js:328:13)
    at /home/runner/workspace/node_modules/express/lib/router/index.js:286:9
    at Function.process_params (/home/runner/workspace/node_modules/express/lib/router/index.js:346:12)
    at next (/home/runner/workspace/node_modules/express/lib/router/index.js:280:10)
    at /home/runner/workspace/node_modules/express-session/index.js:514:7
    at /home/runner/workspace/node_modules/connect-pg-simple/index.js:370:18
    at process.processTicksAndRejections (node:internal/process/task_queues:82:21)
7:20:13 PM [express] GET /api/integrations 500 in 153ms :: {"message":"Internal server error in authâ€¦
Auth debug - Req path: /api/integrations
Auth debug - isAuthenticated method exists: true
Auth debug - isAuthenticated result: true
Auth debug - Has user object: true
Auth debug - Auth header: Missing
Auth debug - Session user: Missing
Auth debug - Session authenticated: No
Critical error in auth wrapper: ReferenceError: Cannot access 'authReq' before initialization
    at <anonymous> (/home/runner/workspace/server/middleware/auth.ts:220:95)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/runner/workspace/node_modules/express/lib/router/route.js:149:13)
    at authMiddleware (/home/runner/workspace/server/middleware/auth.ts:56:18)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/runner/workspace/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/home/runner/workspace/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at /home/runner/workspace/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/home/runner/workspace/node_modules/express/lib/router/index.js:346:12)
    at next (/home/runner/workspace/node_modules/express/lib/router/index.js:280:10)
    at strategy.pass (/home/runner/workspace/node_modules/passport/lib/middleware/authenticate.js:355:9)
    at SessionStrategy.authenticate (/home/runner/workspace/node_modules/passport/lib/strategies/session.js:126:10)
    at attempt (/home/runner/workspace/node_modules/passport/lib/middleware/authenticate.js:378:16)
    at authenticate (/home/runner/workspace/node_modules/passport/lib/middleware/authenticate.js:379:7)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at trim_prefix (/home/runner/workspace/node_modules/express/lib/router/index.js:328:13)
    at /home/runner/workspace/node_modules/express/lib/router/index.js:286:9
    at Function.process_params (/home/runner/workspace/node_modules/express/lib/router/index.js:346:12)
    at next (/home/runner/workspace/node_modules/express/lib/router/index.js:280:10)
    at initialize (/home/runner/workspace/node_modules/passport/lib/middleware/initialize.js:98:5)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at trim_prefix (/home/runner/workspace/node_modules/express/lib/router/index.js:328:13)
    at /home/runner/workspace/node_modules/express/lib/router/index.js:286:9
    at Function.process_params (/home/runner/workspace/node_modules/express/lib/router/index.js:346:12)
    at next (/home/runner/workspace/node_modules/express/lib/router/index.js:280:10)
    at /home/runner/workspace/node_modules/express-session/index.js:514:7
    at /home/runner/workspace/node_modules/connect-pg-simple/index.js:370:18
    at process.processTicksAndRejections (node:internal/process/task_queues:82:21)
7:20:13 PM [express] GET /api/integrations 500 in 149ms :: {"message":"Internal server error in authâ€¦
7:20:13 PM [express] GET /api/watchlists 200 in 437ms :: [{"id":6,"userId":3,"name":"My Watchlist","â€¦
7:20:13 PM [express] GET /api/watchlists/default 200 in 443ms :: {"id":6,"userId":3,"name":"My Watchâ€¦
7:20:13 PM [express] GET /api/watchlists 304 in 466ms :: [{"id":6,"userId":3,"name":"My Watchlist","â€¦
7:20:13 PM [express] GET /api/watchlists/default 304 in 436ms :: {"id":6,"userId":3,"name":"My Watchâ€¦
