INSERT INTO screeners (user_id, name, description, type, source, configuration, results, created_at, updated_at) 
VALUES (
  2, 
  'Advanced Technical Screener', 
  'Uses pandas_ta for Ichimoku Cloud and other advanced indicators', 
  'python', 
  '{"type": "code", "content": "# Using pandas_ta for advanced technical indicators\n\ndef calculate_advanced_indicators(df):\n    \"\"\"Calculate advanced technical indicators using pandas_ta\"\"\"\n    try:\n        import pandas_ta as ta\n        \n        # Make a copy to avoid modifying the original\n        df_copy = df.copy()\n        \n        # Ichimoku Cloud\n        ichimoku = ta.ichimoku(df_copy[\"High\"], df_copy[\"Low\"], df_copy[\"Close\"])\n        df_copy = df_copy.join(ichimoku[\"ISA_9\"])\n        df_copy = df_copy.join(ichimoku[\"ISB_26\"])\n        df_copy = df_copy.join(ichimoku[\"ITS_9\"])\n        df_copy = df_copy.join(ichimoku[\"IKS_26\"])\n        df_copy = df_copy.join(ichimoku[\"ICS_26\"])\n        \n        # Elder Ray Index\n        elder = ta.er(df_copy[\"High\"], df_copy[\"Low\"], df_copy[\"Close\"])\n        df_copy = df_copy.join(elder)\n        \n        # Squeeze Momentum\n        squeeze = ta.squeeze(df_copy[\"High\"], df_copy[\"Low\"], df_copy[\"Close\"])\n        df_copy = df_copy.join(squeeze)\n        \n        return df_copy\n    except ImportError:\n        print(\"Warning: pandas_ta not available, using basic indicators\")\n        return df\n\ndef screen_stocks(data_dict):\n    \"\"\"Screen stocks using advanced technical indicators\"\"\"\n    results = {}\n    matches = []\n    \n    for symbol, df in data_dict.items():\n        if df.empty or len(df) < 50:\n            continue\n            \n        # Add advanced indicators\n        df_advanced = calculate_advanced_indicators(df)\n        \n        # Skip if data frame does not have our indicators\n        if not all(col in df_advanced.columns for col in [\"ISA_9\", \"ISB_26\", \"ICS_26\"]):\n            continue\n        \n        latest = df_advanced.iloc[-1]\n        \n        # Ichimoku Cloud Strategy\n        price_above_cloud = latest[\"Close\"] > latest[\"ISA_9\"] and latest[\"Close\"] > latest[\"ISB_26\"]\n        conversion_above_base = latest[\"ITS_9\"] > latest[\"IKS_26\"]\n        \n        # Bullish squeeze momentum (if available)\n        squeeze_momentum = False\n        if \"SQZ_20_2.0_20_1.5_2\" in df_advanced.columns and \"SQZ_ON\" in df_advanced.columns:\n            squeeze_momentum = latest[\"SQZ_20_2.0_20_1.5_2\"] > 0 and latest[\"SQZ_ON\"] == 1\n            \n        # Check if price is in uptrend (above 50-day MA)\n        price_uptrend = latest[\"Close\"] > latest[\"SMA_50\"]\n        \n        # Volume confirmation\n        volume_confirming = latest[\"Volume\"] > latest[\"Volume_SMA_20\"]\n        \n        # Combine criteria - need Ichimoku cloud bullish and either momentum or uptrend\n        signal_strength = 0\n        if price_above_cloud: signal_strength += 1\n        if conversion_above_base: signal_strength += 1\n        if squeeze_momentum: signal_strength += 1\n        if price_uptrend: signal_strength += 1\n        if volume_confirming: signal_strength += 1\n        \n        if signal_strength >= 3 and price_above_cloud:  # At least 3 conditions including price above cloud\n            matches.append(symbol)\n            results[symbol] = {\n                \"close\": float(latest[\"Close\"]),\n                \"signal_strength\": signal_strength,\n                \"cloud_bullish\": price_above_cloud,\n                \"conversion_bullish\": conversion_above_base,\n                \"squeeze_momentum\": squeeze_momentum,\n                \"uptrend\": price_uptrend,\n                \"volume_confirming\": volume_confirming\n            }\n    \n    return {\n        \"matches\": matches,\n        \"details\": results\n    }"}', 
  '{"assets": ["AAPL", "MSFT", "GOOGL", "AMZN", "META", "TSLA", "NVDA", "AMD", "INTC", "NFLX", "DIS", "V", "MA", "JPM", "BAC", "WMT", "TGT", "COST", "HD", "LOW", "XOM", "CVX", "COP", "PFE", "MRK", "JNJ", "ABBV", "LLY", "KO", "PEP", "MCD", "SBUX"], "parameters": {"ichimoku_lookback": 26}}', 
  '{}', 
  NOW(), 
  NOW()
);